<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Documentation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body
    class="min-h-screen flex items-center justify-center bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 text-white p-8"
  >
    <div class="max-w-4xl mx-auto bg-gray-800 shadow-lg rounded-lg p-8">
      <!-- Title Section -->
      <h1 class="text-3xl font-extrabold text-center mb-6">
        API Documentation
      </h1>
      <p class="text-center text-gray-300 mb-8">
        Comprehensive guide for developers to integrate with our API.
      </p>

      <!-- Table of Contents -->
      <div class="mb-10">
        <h2 class="text-xl font-semibold text-gray-200 mb-4">
          Table of Contents
        </h2>
        <ul class="text-gray-400 list-disc ml-5 space-y-2">
          <li>
            <a href="#authentication" class="hover:text-white"
              >Authentication</a
            >
          </li>
          <li>
            <a href="#api-endpoints" class="hover:text-white">API Endpoints</a>
          </li>
          <li><a href="#webhooks" class="hover:text-white">Webhooks</a></li>
        </ul>
      </div>

      <!-- Section: Authentication -->
      <section id="authentication" class="mb-10">
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">
          Authentication
        </h2>
        <p class="text-gray-400 mb-4">
          Authenticate users with OAuth2 providers like Discord, GitHub, and
          Google.
        </p>
        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>GET /auth/:provider?service={service}&redirect={redirectUrl}</code>
          </pre>
        </div>
        <p class="text-gray-400">
          Replace <code class="text-gray-200">:provider</code> with either
          <code class="text-gray-200">discord</code>,
          <code class="text-gray-200">github</code>, or
          <code class="text-gray-200">google</code>. Provide the
          <code class="text-gray-200">service</code> and
          <code class="text-gray-200">redirect</code> parameters.
        </p>
      </section>

      <!-- Section: API Endpoints -->
      <section id="api-endpoints" class="mb-10">
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">API Endpoints</h2>
        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>GET /auth/me
Returns user information if authenticated.</code>
          </pre>
        </div>
        <p class="text-gray-400 mb-4">
          Retrieves the details of the authenticated user.
        </p>

        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>DELETE /auth/logout
Logs the user out and clears session.</code>
          </pre>
        </div>
        <p class="text-gray-400">
          Ends the user session and removes authentication tokens.
        </p>
      </section>

      <!-- Section: Webhook Endpoint -->
      <section id="webhooks" class="mb-10">
        <h2
          class="text-2xl font-semibold text-gray-100 mb-4"
          data-en="Webhooks"
          data-th="เว็บฮุค"
        >
          Webhooks
        </h2>
        <p
          class="text-gray-400 mb-4"
          data-en="Webhooks allow our service to notify your application about specific events, such as user logins."
          data-th="เว็บฮุคช่วยให้บริการของเราสามารถแจ้งเตือนแอปพลิเคชันของคุณเกี่ยวกับเหตุการณ์เฉพาะ เช่น การเข้าสู่ระบบของผู้ใช้."
        >
          Webhooks allow our service to notify your application about specific
          events, such as user logins.
        </p>
        <p
          class="text-gray-400 mb-4"
          data-en="To receive webhooks, you must register your service with BSO OpenID and obtain a unique service identifier, hookSecret, and specify the url."
          data-th="เพื่อรับเว็บฮุค คุณต้องลงทะเบียนบริการของคุณกับ BSO OpenID เพื่อรับรหัสประจำตัวบริการ hookSecret และระบุ URL."
        >
          To receive webhooks, you must register your service with BSO OpenID
          and obtain a unique service identifier,
          <code class="text-gray-200">hookSecret</code>, and specify the
          <code class="text-gray-200">url</code>.
        </p>

        <h3
          class="text-xl font-semibold text-gray-100 mb-2"
          data-en="Webhook Endpoint"
          data-th="ปลายทางเว็บฮุค"
        >
          Webhook Endpoint
        </h3>
        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>POST /open/hook
Headers:
    x-hook-token: JWT token for validation (required)
    x-hook-signature: HMAC-SHA256 signature of the payload (required)</code>
          </pre>
        </div>

        <h3
          class="text-xl font-semibold text-gray-100 mb-2 mt-6"
          data-en="Validating Webhooks"
          data-th="การตรวจสอบเว็บฮุค"
        >
          Validating Webhooks
        </h3>
        <p
          class="text-gray-400 mb-4"
          data-en="To ensure security, webhooks include two layers of validation: JWT token validation and HMAC-SHA256 signature validation."
          data-th="เพื่อความปลอดภัย เว็บฮุคประกอบด้วยการตรวจสอบสองชั้น: การตรวจสอบโทเค็น JWT และการตรวจสอบลายเซ็น HMAC-SHA256."
        >
          To ensure security, webhooks include two layers of validation: JWT
          token validation and HMAC-SHA256 signature validation.
        </p>

        <!-- JWT Validation -->
        <h4
          class="text-lg font-semibold text-gray-100 mb-2"
          data-en="JWT Validation"
          data-th="การตรวจสอบ JWT"
        >
          JWT Validation
        </h4>
        <p
          class="text-gray-400 mb-4"
          data-en="The webhook includes a x-hook-token header with a JWT. Validate this token using your hookSecret."
          data-th="เว็บฮุคประกอบด้วยหัวข้อ x-hook-token พร้อม JWT ตรวจสอบโทเค็นนี้โดยใช้ hookSecret ของคุณ."
        >
          The webhook includes a
          <code class="text-gray-200">x-hook-token</code> header with a JWT.
          Validate this token using your
          <code class="text-gray-200">hookSecret</code>.
        </p>
        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>import jwt from 'jsonwebtoken';

const hookSecret = process.env.HOOK_SECRET;

function validateJWT(req, res, next) {
  const token = req.headers['x-hook-token'];
  if (!token) {
    return res.status(401).json({ error: 'No token provided' });
  }
  try {
    jwt.verify(token, hookSecret);
    next();
  } catch (error) {
    res.status(403).json({ error: 'Invalid or expired token' });
  }
}</code>
          </pre>
        </div>

        <!-- HMAC-SHA256 Validation -->
        <h4
          class="text-lg font-semibold text-gray-100 mb-2 mt-6"
          data-en="HMAC-SHA256 Signature Validation"
          data-th="การตรวจสอบลายเซ็น HMAC-SHA256"
        >
          HMAC-SHA256 Signature Validation
        </h4>
        <p
          class="text-gray-400 mb-4"
          data-en="Validate the x-hook-signature header by computing the HMAC-SHA256 of the payload with your hookSecret."
          data-th="ตรวจสอบหัวข้อ x-hook-signature โดยการคำนวณ HMAC-SHA256 ของ payload ด้วย hookSecret ของคุณ."
        >
          Validate the
          <code class="text-gray-200">x-hook-signature</code> header by
          computing the HMAC-SHA256 of the payload with your
          <code class="text-gray-200">hookSecret</code>.
        </p>
        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>import crypto from 'crypto';

const hookSecret = process.env.HOOK_SECRET;

function validateSignature(req, res, next) {
  const signature = req.headers['x-hook-signature'];
  const payload = JSON.stringify(req.body);
  if (!signature) {
    return res.status(400).json({ error: 'Missing signature' });
  }
  const computedSignature = crypto
    .createHmac('sha256', hookSecret)
    .update(payload)
    .digest('hex');

  if (crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(computedSignature))) {
    next();
  } else {
    res.status(403).json({ error: 'Invalid signature' });
  }
}</code>
          </pre>
        </div>
      </section>

      <!-- Section: Webhook Endpoint -->
      <section id="webhook-endpoint" class="mb-10">
        <h2 class="text-2xl font-semibold text-gray-100 mb-4">
          Webhook Endpoint
        </h2>
        <p class="text-gray-400 mb-4">
          The <code>/open/hook</code> endpoint receives webhook notifications,
          applying both JWT and HMAC-SHA256 validation to ensure data integrity
          and authenticity. If the request passes validation, the endpoint logs
          the received data and sends a success response.
        </p>
        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>app.post("/open/hook", validateHookJWT, validateSignature, (req, res) => {
    const body = req.body;
    console.log("Received hook:", body);
    res.status(200).json({ message: "Hook received." });
});</code>
              </pre>
        </div>
      </section>

      <!-- Section: Webhook Data Structure -->
      <section id="webhook-data" class="mb-10">
        <h2
          class="text-2xl font-semibold text-gray-100 mb-4"
          data-en="Webhook Data Structure"
          data-th="โครงสร้างข้อมูลเว็บฮุค"
        >
          Webhook Data Structure
        </h2>
        <p
          class="text-gray-400 mb-4"
          data-en="The webhook sends the following data structure to your specified endpoint."
          data-th="เว็บฮุคจะส่งข้อมูลไปยัง endpoint ที่คุณกำหนดโดยมีโครงสร้างข้อมูลดังนี้"
        >
          The webhook sends the following data structure to your specified
          endpoint.
        </p>

        <!-- Example Data Structure -->
        <div class="bg-gray-700 rounded-md p-4 mb-4 overflow-x-auto">
          <pre class="text-sm text-gray-200">
<code>{
  "event": "user.login",
  "user": {
    "id": "user123",
    "username": "exampleUser",
    "firstName": "John",
    "lastName": "Doe",
    "email": "example@example.com",
    "image": "https://example.com/avatar.jpg",
    "createdAt": "2024-01-01T12:00:00Z",
    "updatedAt": "2024-01-02T15:30:00Z"
  },
  "service": "ExampleService",
  "ip": "192.168.1.1",
  "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
  "timestamp": "2024-11-10T12:34:56Z"
}</code>
          </pre>
        </div>

        <!-- Explanation of Data Fields -->
        <h3
          class="text-xl font-semibold text-gray-100 mb-2 mt-6"
          data-en="Data Field Descriptions"
          data-th="คำอธิบายฟิลด์ข้อมูล"
        >
          Data Field Descriptions
        </h3>
        <ul class="text-gray-400 list-disc ml-5 space-y-2">
          <li
            data-en="<strong>event</strong>: The name of the event, e.g., 'user.login', 'user.logout', or 'user.register'."
            data-th="<strong>event</strong>: ชื่อของเหตุการณ์ เช่น 'user.login', 'user.logout', หรือ 'user.register'."
          >
            <strong>event</strong>: The name of the event, e.g., 'user.login',
            'user.logout', or 'user.register'.
          </li>
          <li
            data-en="<strong>user</strong>: Object containing user information related to the event."
            data-th="<strong>user</strong>: วัตถุที่มีข้อมูลผู้ใช้ที่เกี่ยวข้องกับเหตุการณ์."
          >
            <strong>user</strong>: Object containing user information related to
            the event.
          </li>
          <li
            data-en="<strong>service</strong>: The name of the service that triggered the webhook, e.g., 'ExampleService'."
            data-th="<strong>service</strong>: ชื่อของบริการที่ส่ง webhook, เช่น 'ExampleService'."
          >
            <strong>service</strong>: The name of the service that triggered the
            webhook, e.g., 'ExampleService'.
          </li>
          <li
            data-en="<strong>ip</strong>: The IP address of the user associated with the event."
            data-th="<strong>ip</strong>: IP Address ของผู้ใช้ที่เกี่ยวข้องกับเหตุการณ์."
          >
            <strong>ip</strong>: The IP address of the user associated with the
            event.
          </li>
          <li
            data-en="<strong>userAgent</strong>: The User-Agent string of the browser or application used by the user."
            data-th="<strong>userAgent</strong>: User-Agent ของเบราว์เซอร์หรือแอปพลิเคชันที่ใช้โดยผู้ใช้."
          >
            <strong>userAgent</strong>: The User-Agent string of the browser or
            application used by the user.
          </li>
          <li
            data-en="<strong>timestamp</strong>: The time the event occurred, in ISO 8601 format."
            data-th="<strong>timestamp</strong>: เวลาที่เกิดเหตุการณ์ในรูปแบบ ISO 8601."
          >
            <strong>timestamp</strong>: The time the event occurred, in ISO 8601
            format.
          </li>
        </ul>
      </section>

      <!-- Footer -->
      <footer class="text-center text-gray-400 mt-12">
        <p>
          For additional information, please refer to our API documentation.
        </p>
      </footer>
    </div>
  </body>
</html>
